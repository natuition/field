<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Violette</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/bootstrap.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap/bootstrap.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='icon.png') }}">
    <script>
        var socketio = io.connect('http://' + document.domain + ':' + location.port + '/server');
    </script>
</head>

<body>
    <h1 style="text-align: center; padding: 10px 0;">Calibration</h1>
    <div class="row">
        <div class="mx-auto col-10 col-md-8 col-lg-6">
            {% if error %}
            <div class="alert alert-danger" role="alert">
                {{ error }}
            </div>
            {% endif %}
            <form action="/calibrate" method='post' class="row g-3">
                <div class="col-12">
                    <label for="password">Log in to have permissions for calibration.</label>
                    <div class="input-group">
                        <div class="input-group-text">Password : </div>
                        <input type="password" class="form-control" id="password" name="password" placeholder="">
                    </div>
                </div>
                <div class="col-12">
                    <div class="btn-group-vertical m-1">
                        <button type="button" id="cancel" class="btn btn-outline-danger"
                            onclick="quit();">Quitter</button>
                    </div>
                    <div class="btn-group-vertical m-1">
                        <button type="submit" class="btn btn-outline-success" value="Submit">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script>
        function quit() {
            $('#cancel').html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
            socketio.emit('data', { type: "calibration_cancel" })
        }

        socketio.on('href_to', function (data) {
            if (data["delay"] != undefined) {
                var reloader = setTimeout(() => {
                    window.location.href = 'http://' + document.domain + data["href"];
                    reloader = undefined;
                }, data["delay"]);
            } else {
                window.location.href = 'http://' + document.domain + data["href"];
            }
        });
    </script>
</body>

</html>